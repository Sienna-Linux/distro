name: bluecat
description: uBlue imaged tweaked by PolyCat with nvidia drivers

base-image: ghcr.io/ublue-os/silverblue-nvidia
image-version: latest

modules:
  - type: script
    scripts:
      - remove-default-backgrounds.sh
    snippets:
      - rm -f /usr/share/ublue-os/just/10-update.just

  - type: files
    files:
      - source: system
        destination: /

  - type: bling
    install:
      - rpmfusion

  - from-file: install-akmods.yml

  #  - type: script
  #    scripts:
  #      - install-otd.sh

  - type: gnome-extensions
    install:
      - 615 # AppIndicator and KStatusNotifierItem Support
      - 517 # Caffeine
      - 3193 # Blur my Shell

  - type: fonts
    fonts:
      nerd-fonts:
        - Hack

  - type: brew
    brew-analytics: false
    auto-update: false
    auto-upgrade: false
    nofile-limits: true

  - type: dnf
    repos:
      files:
        - https://download.docker.com/linux/fedora/docker-ce.repo
#        - codium.repo
      copr:
        - pgdev/ghostty
    install:
      packages:
        - loupe
        - celluloid
        - gnome-tweaks
        - stow
        - ghostty
        - btop
        - ripgrep
        - fuse-sshfs
        - steam
        - mangohud

        # Dev Tools
        - neovim
        - clang
        - make
        - python3-devel
        - android-tools
        - git-lfs

        # Container Tools
        - docker-ce
        - docker-ce-cli
        - containerd.io
        - docker-compose-plugin

        # Themes
        - adw-gtk3-theme

        # Deps
        - nautilus-python
        - openssl
        - libxcrypt-compat

    remove:
      auto-remove: true
      packages:
        - firefox
        - firefox-langpacks
        - gnome-shell-extension-background-logo
        - gnome-shell-extension-apps-menu
        - gnome-shell-extension-launch-new-instance
        - gnome-shell-extension-window-list
        - gnome-shell-extension-places-menu
        - ptyxis
        - nvtop
        - gnome-system-monitor
        - gnome-tour
        - dconf-editor
        - htop
        - gnome-extensions-app

  - type: script
    snippets:
      - "sed -i 's/^Terminal=true/Terminal=false/' /usr/share/applications/nvim.desktop"
      - "sed -i 's|^Exec=.*|Exec=/usr/bin/ghostty -e nvim %F|' /usr/share/applications/nvim.desktop"

  - type: default-flatpaks
    configurations:
      - notify: false
        scope: user
        install:
          - com.mattjakeman.ExtensionManager
          - org.gnome.Calendar
          - com.github.tchx84.Flatseal
          - it.mijorus.gearlever
          - io.missioncenter.MissionCenter
          - org.gnome.Papers

  - type: systemd
    system:
      enabled:
        - docker.service
        - containerd.service
        - podman.service
      disabled:
        - flatpak-system-update.timer
        - rpm-ostreed-automatic.timer

    user:
      disabled:
        - flatpak-user-update.timer

  - type: signing # this sets up the proper policy & signing files for signed images to work fully
